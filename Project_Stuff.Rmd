---
title: "Project Stuff"
author: "Owen Wright"
date: "11/15/2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(igraph)
library(tm)
library(SnowballC)
library(wordcloud)
library(RColorBrewer)

```

#activities imports, adding names as a column to aid in our kudos network
```{r}
Elliot_run<-read_csv("Elliot/activities.csv")%>% #Elliot's data messing
  filter(type=="Run",
         date>"2018-6-01")%>%
  mutate(miles=distance/1609,
         minutes=elapsed_time/60,
         pace=minutes/miles)%>%
  select(-type, -gear, -commute)%>%
  mutate(person="ell",
         count=131)

Justin_run<-read_csv("Fursnatch/activities.csv")%>% #Justin's data messing
  filter(type=="Run",
         date>"2018-6-01")%>%
  mutate(miles=distance/1609,
         minutes=elapsed_time/60,
         pace=minutes/miles)%>%
  select(-type, -gear, -commute)%>%
  mutate(person="justin",
         count=936)
Mowgli_run<-read_csv("Mowgli/activities.csv")%>% 
  filter(type=="Run",
         date>"2018-6-01")%>%
  mutate(miles=distance/1609,
         minutes=elapsed_time/60,
         pace=minutes/miles)%>%
  select(-type, -gear, -commute)%>%
  mutate(person="mowg",
         count=335)
Birdo_run<-read_csv("Birdo/activities.csv")%>%
  filter(type=="Run",
         date>"2018-6-01")%>%
  mutate(miles=distance/1609,
         minutes=elapsed_time/60,
         pace=minutes/miles)%>%
  select(-type, -gear, -commute)%>%
  mutate(person="birdo",
         count=642)

Jackson <- read_csv("Jackson/activities.csv")
Jackson_run<-Jackson%>%
  filter(type=="Run",
         date>"2018-6-01")%>%
  mutate(miles=distance/1609,
         minutes=elapsed_time/60,
         pace=minutes/miles)%>%
  select(-type,-gear, -commute)%>%
  mutate(person="jack",
         count=531)
Finn_run<-read_csv("Finn/Finn/activities.csv")%>%
  filter(type=="Run",
         date>"2018-6-01")%>%
  mutate(miles=distance/1609,
         minutes=elapsed_time/60,
         pace=minutes/miles)%>%
  select(-type,-gear, -commute)%>%
  mutate(person="finn",
         count=370)
Plumb_run<-read_csv("Plumb/activities.csv")%>%
  filter(type=="Run",
         date>"2018-6-01")%>%
  mutate(miles=distance/1609,
         minutes=elapsed_time/60,
         pace=minutes/miles)%>%
  select(-type,-gear, -commute)%>%
  mutate(person="plumb",
         count=761)

all_activities<-Elliot_run%>%
  rbind(Justin_run, Birdo_run, Mowgli_run, Jackson_run, Finn_run, Plumb_run)%>%
  select(-filename)


count(Finn_run$name)[[1]]
## WORD CLOUD http://www.sthda.com/english/wiki/text-mining-and-word-cloud-fundamentals-in-r-5-simple-steps-you-should-know
word <- function(runner, runner_n, runner_des){
for(i in 1:count(runner)[[1]]){
  write(runner_n[i], file="out.txt", append=TRUE)
  write(runner_des[i],file="out.txt",append=TRUE)
}

filePath <- "out.txt"
text <- readLines(filePath)
docs <- Corpus(VectorSource(text))
toSpace <- content_transformer(function (x , pattern ) gsub(pattern, " ", x))
docs <- tm_map(docs, toSpace, "/")
docs <- tm_map(docs, toSpace, "@")
docs <- tm_map(docs, toSpace, "\\|")
# Convert the text to lower case
docs <- tm_map(docs, content_transformer(tolower))
# Remove numbers
docs <- tm_map(docs, removeNumbers)
# Remove english common stopwords
docs <- tm_map(docs, removeWords, stopwords("english"))
# Remove your own stop word
# specify your stopwords as a character vector
docs <- tm_map(docs, removeWords, c("blabla1", "blabla2")) 
# Remove punctuations
docs <- tm_map(docs, removePunctuation)
# Eliminate extra white spaces
docs <- tm_map(docs, stripWhitespace)
# Text stemming
# docs <- tm_map(docs, stemDocument)
dtm <- TermDocumentMatrix(docs)
m <- as.matrix(dtm)
v <- sort(rowSums(m),decreasing=TRUE)
d <- data.frame(word = names(v),freq=v)
set.seed(1234)
wordcloud(words = d$word, freq = d$freq, min.freq = 5,
          max.words=200, random.order=FALSE, rot.per=0.25, 
          colors=brewer.pal(8, "Dark2"))
}

word(Finn_run, Finn_run$name, Finn_run$description)

```


#Kudos imports, adding column with name to create network
```{r}
Finn_kudos<- read_csv("Finn/Finn/kudos.csv")%>%
  mutate(giver="finn")
Justin_kudos<- read_csv("Fursnatch/kudos.csv")%>%
  mutate(giver="justin")
Jackson_kudos<- read_csv("Jackson/kudos.csv")%>%
  mutate(giver="jack")
Mowgli_kudos<- read_csv("Mowgli/kudos.csv")%>%
  mutate(giver="mowg")
Plumb_kudos<- read_csv("Plumb/kudos.csv")%>%
  mutate(giver="plumb")
all_kudos<-Finn_kudos%>%
  rbind(Justin_kudos, Jackson_kudos, Mowgli_kudos, Plumb_kudos)

#merging all activities and kudos 
#then we can mess around with grouping to create our network
network<-all_kudos%>%
  inner_join(all_activities, by="id")%>%
  select(giver, person, elapsed_time, distance, miles, minutes, pace, name, description, count)%>%
  group_by(giver, person)%>%
  summarise(number=n())%>%
  spread(person, number, drop=FALSE, fill=0)%>%
  ungroup()%>%
  select(-birdo, -ell,-giver)
net_matrix<-as.matrix(network)

g<-graph.adjacency(net_matrix, mode="direct", weighted=NULL)


df <- function(giver, taker){
  giver %>%
    inner_join(taker, by="id") %>%
    count()
  
}
net_matrix


```

